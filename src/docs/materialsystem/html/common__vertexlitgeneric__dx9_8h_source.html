<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>materialsystem: materialsystem/stdshaders/common_vertexlitgeneric_dx9.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">materialsystem
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('common__vertexlitgeneric__dx9_8h_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">common_vertexlitgeneric_dx9.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="common__vertexlitgeneric__dx9_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//========= Copyright Valve Corporation, All rights reserved. ============//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#ifndef COMMON_VERTEXLITGENERIC_DX9_H_</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#define COMMON_VERTEXLITGENERIC_DX9_H_</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common__ps__fxc_8h.html">common_ps_fxc.h</a>&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//  We store four light colors and positions in an</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//  array of three of these structures like so:</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//       x      y       z      w</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//    +------+------+------+------+</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//    |       L0.rgb       |      |</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//    +------+------+------+      |</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//    |       L0.pos       |  L3  |</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//    +------+------+------+  rgb |</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//    |       L1.rgb       |      |</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//    +------+------+------+------+</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//    |       L1.pos       |      |</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//    +------+------+------+      |</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//    |       L2.rgb       |  L3  |</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//    +------+------+------+  pos |</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//    |       L2.pos       |      |</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//    +------+------+------+------+</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="struct_pixel_shader_light_info.html">   25</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_pixel_shader_light_info.html">PixelShaderLightInfo</a></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div><div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="struct_pixel_shader_light_info.html#ac15889100963cebf0e2554f2d2a36c69">   27</a></span>&#160;    float4 <a class="code" href="struct_pixel_shader_light_info.html#ac15889100963cebf0e2554f2d2a36c69">color</a>;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="struct_pixel_shader_light_info.html#a4322319bb973caf21f78272ad1428f60">   28</a></span>&#160;    float4 <a class="code" href="struct_pixel_shader_light_info.html#a4322319bb973caf21f78272ad1428f60">pos</a>;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;};</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#abdb10265726098c8785c9237843ce824">   31</a></span>&#160;<span class="preprocessor">#define cOverbright 2.0f</span></div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#ae7c0e7ea4c21d7696d55b7fc4942b986">   32</a></span>&#160;<span class="preprocessor">#define cOOOverbright 0.5f</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#ab5260a65140b340cb52e0373d8e686fa">   34</a></span>&#160;<span class="preprocessor">#define LIGHTTYPE_NONE              0</span></div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a58af362c323541c539da9ea97a8bb58c">   35</a></span>&#160;<span class="preprocessor">#define LIGHTTYPE_SPOT              1</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a4095a15fd0aa09b0a50cdc99f2073b96">   36</a></span>&#160;<span class="preprocessor">#define LIGHTTYPE_POINT             2</span></div><div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a628cacf0fed9994ec49b9384207947e6">   37</a></span>&#160;<span class="preprocessor">#define LIGHTTYPE_DIRECTIONAL       3</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">// Better suited to Pixel shader models, 11 instructions in pixel shader</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">// ... actually, now only 9: mul, cmp, cmp, mul, mad, mad, mad, mad, mad</span></div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a9203bfdbac5f7bb30cc2321618f8f7cf">   41</a></span>&#160;float3 <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a9203bfdbac5f7bb30cc2321618f8f7cf">PixelShaderAmbientLight</a>( <span class="keyword">const</span> float3 worldNormal, <span class="keyword">const</span> float3 cAmbientCube[6] )</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;{</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    float3 linearColor, nSquared = worldNormal * worldNormal;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    float3 isNegative = ( worldNormal &gt;= 0.0 ) ? 0 : nSquared;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    float3 isPositive = ( worldNormal &gt;= 0.0 ) ? nSquared : 0;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    linearColor = isPositive.x * cAmbientCube[0] + isNegative.x * cAmbientCube[1] +</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                  isPositive.y * cAmbientCube[2] + isNegative.y * cAmbientCube[3] +</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                  isPositive.z * cAmbientCube[4] + isNegative.z * cAmbientCube[5];</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">return</span> linearColor;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">// Better suited to Vertex shader models</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// Six VS instructions due to use of constant indexing (slt, mova, mul, mul, mad, mad)</span></div><div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a86f967e67da1c20e19bda6425d3be3c7">   54</a></span>&#160;float3 <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a86f967e67da1c20e19bda6425d3be3c7">VertexShaderAmbientLight</a>( <span class="keyword">const</span> float3 worldNormal, <span class="keyword">const</span> float3 cAmbientCube[6] )</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;{</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    float3 nSquared = worldNormal * worldNormal;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    int3 isNegative = ( worldNormal &lt; 0.0 );</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    float3 linearColor;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    linearColor = nSquared.x * cAmbientCube[isNegative.x] +</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                  nSquared.y * cAmbientCube[isNegative.y+2] +</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                  nSquared.z * cAmbientCube[isNegative.z+4];</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">return</span> linearColor;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a347c1dd312f8b524eeadf1579aed8312">   65</a></span>&#160;float3 <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a347c1dd312f8b524eeadf1579aed8312">AmbientLight</a>( <span class="keyword">const</span> float3 worldNormal, <span class="keyword">const</span> float3 cAmbientCube[6] )</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// Vertex shader cases</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#ifdef SHADER_MODEL_VS_1_0</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a86f967e67da1c20e19bda6425d3be3c7">VertexShaderAmbientLight</a>( worldNormal, cAmbientCube );</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#elif SHADER_MODEL_VS_1_1</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a86f967e67da1c20e19bda6425d3be3c7">VertexShaderAmbientLight</a>( worldNormal, cAmbientCube );</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#elif SHADER_MODEL_VS_2_0</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a86f967e67da1c20e19bda6425d3be3c7">VertexShaderAmbientLight</a>( worldNormal, cAmbientCube );</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#elif SHADER_MODEL_VS_3_0</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a86f967e67da1c20e19bda6425d3be3c7">VertexShaderAmbientLight</a>( worldNormal, cAmbientCube );</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// Pixel shader case</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a9203bfdbac5f7bb30cc2321618f8f7cf">PixelShaderAmbientLight</a>( worldNormal, cAmbientCube );</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">//-----------------------------------------------------------------------------</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">// Purpose: Compute scalar diffuse term with various optional tweaks such as</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">//          Half Lambert and ambient occlusion</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">//-----------------------------------------------------------------------------</span></div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a0c47480ee68b5b192353cb2197eb7de8">   86</a></span>&#160;float3 <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a0c47480ee68b5b192353cb2197eb7de8">DiffuseTerm</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> bHalfLambert, <span class="keyword">const</span> float3 worldNormal, <span class="keyword">const</span> float3 lightDir,</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoAmbientOcclusion, <span class="keyword">const</span> <span class="keywordtype">float</span> fAmbientOcclusion,</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoLightingWarp, in sampler lightWarpSampler )</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;{</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordtype">float</span> fResult;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordtype">float</span> NDotL = dot( worldNormal, lightDir );             <span class="comment">// Unsaturated dot (-1 to 1 range)</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">if</span> ( bHalfLambert )</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        fResult = saturate(NDotL * 0.5 + 0.5);              <span class="comment">// Scale and bias to 0 to 1 range</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">if</span> ( !bDoLightingWarp )</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            fResult *= fResult;                             <span class="comment">// Square</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        fResult = saturate( NDotL );                        <span class="comment">// Saturate pure Lambertian term</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">if</span> ( bDoAmbientOcclusion )</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="comment">// Raise to higher powers for darker AO values</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">//      float fAOPower = lerp( 4.0f, 1.0f, fAmbientOcclusion );</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">//      result *= pow( NDotL * 0.5 + 0.5, fAOPower );</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        fResult *= fAmbientOcclusion;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    float3 fOut = float3( fResult, fResult, fResult );</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">if</span> ( bDoLightingWarp )</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        fOut = 2.0f * tex1D( lightWarpSampler, fResult );</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">return</span> fOut;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a7b816668d8202ad2ca516b0bc6a3bf3a">  125</a></span>&#160;float3 <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a7b816668d8202ad2ca516b0bc6a3bf3a">PixelShaderDoGeneralDiffuseLight</a>( <span class="keyword">const</span> <span class="keywordtype">float</span> fAtten, <span class="keyword">const</span> float3 worldPos, <span class="keyword">const</span> float3 worldNormal,</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                                         in sampler NormalizeSampler,</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                         <span class="keyword">const</span> float3 vPosition, <span class="keyword">const</span> float3 vColor, <span class="keyword">const</span> <span class="keywordtype">bool</span> bHalfLambert,</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoAmbientOcclusion, <span class="keyword">const</span> <span class="keywordtype">float</span> fAmbientOcclusion,</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoLightingWarp, in sampler lightWarpSampler )</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;{</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">#if (defined(SHADER_MODEL_PS_2_B) || defined(SHADER_MODEL_PS_3_0))</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    float3 lightDir = normalize( vPosition - worldPos );</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    float3 lightDir = <a class="code" href="common__ps__fxc_8h.html#abc27c8bf80d2bb826a5172f9c2818c21">NormalizeWithCubemap</a>( NormalizeSampler, vPosition - worldPos );</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">return</span> vColor * fAtten * <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a0c47480ee68b5b192353cb2197eb7de8">DiffuseTerm</a>( bHalfLambert, worldNormal, lightDir, bDoAmbientOcclusion, fAmbientOcclusion, bDoLightingWarp, lightWarpSampler );</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a5412ac1f9d20bd8519a9a7854b09695d">  139</a></span>&#160;float3 <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a5412ac1f9d20bd8519a9a7854b09695d">PixelShaderGetLightVector</a>( <span class="keyword">const</span> float3 worldPos, <a class="code" href="struct_pixel_shader_light_info.html">PixelShaderLightInfo</a> <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[3], <span class="keywordtype">int</span> nLightIndex )</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;{</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">if</span> ( nLightIndex == 3 )</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="comment">// Unpack light 3 from w components...</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        float3 vLight3Pos = float3( <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[1].pos.w, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[2].<a class="code" href="struct_light_info.html#a696f8b52d7e032ad0fb46286fe27aebf">color</a>.w, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[2].<a class="code" href="struct_light_info.html#a153d25be0d6e9e96e693e73fca7273a1">pos</a>.w );</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">return</span> normalize( vLight3Pos - worldPos );</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">return</span> normalize( <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[nLightIndex].pos - worldPos );</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;}</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a37d7229b0640d7b435f6ad5c24c6071c">  153</a></span>&#160;float3 <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a37d7229b0640d7b435f6ad5c24c6071c">PixelShaderGetLightColor</a>( <a class="code" href="struct_pixel_shader_light_info.html">PixelShaderLightInfo</a> <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[3], <span class="keywordtype">int</span> nLightIndex )</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;{</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> ( nLightIndex == 3 )</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">// Unpack light 3 from w components...</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">return</span> float3( <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[0].color.w, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[0].<a class="code" href="struct_light_info.html#a153d25be0d6e9e96e693e73fca7273a1">pos</a>.w, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[1].<a class="code" href="struct_light_info.html#a696f8b52d7e032ad0fb46286fe27aebf">color</a>.w );</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[nLightIndex].<a class="code" href="struct_light_info.html#a696f8b52d7e032ad0fb46286fe27aebf">color</a>.rgb;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a36abecaee35a0b1636ed98b31ef17ff5">  167</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a36abecaee35a0b1636ed98b31ef17ff5">SpecularAndRimTerms</a>( <span class="keyword">const</span> float3 vWorldNormal, <span class="keyword">const</span> float3 vLightDir, <span class="keyword">const</span> <span class="keywordtype">float</span> fSpecularExponent,</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                          <span class="keyword">const</span> float3 vEyeDir, <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoAmbientOcclusion, <span class="keyword">const</span> <span class="keywordtype">float</span> fAmbientOcclusion,</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                          <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoSpecularWarp, in sampler specularWarpSampler, <span class="keyword">const</span> <span class="keywordtype">float</span> fFresnel,</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                          <span class="keyword">const</span> float3 color, <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoRimLighting, <span class="keyword">const</span> <span class="keywordtype">float</span> fRimExponent,</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                          <span class="comment">// Outputs</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                          out float3 specularLighting, out float3 rimLighting )</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    rimLighting = float3(0.0f, 0.0f, 0.0f);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">//float3 vReflect = reflect( -vEyeDir, vWorldNormal );              // Reflect view through normal</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    float3 vReflect = 2 * vWorldNormal * dot( vWorldNormal , vEyeDir ) - vEyeDir; <span class="comment">// Reflect view through normal</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">float</span> LdotR = saturate(dot( vReflect, vLightDir ));                 <span class="comment">// L.R  (use half-angle instead?)</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    specularLighting = pow( LdotR, fSpecularExponent );                 <span class="comment">// Raise to specular exponent</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// Optionally warp as function of scalar specular and fresnel</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span> ( bDoSpecularWarp )</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        specularLighting *= tex2D( specularWarpSampler, float2(specularLighting.x, fFresnel) ); <span class="comment">// Sample at { (L.R)^k, fresnel }</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    specularLighting *= saturate(dot( vWorldNormal, vLightDir ));       <span class="comment">// Mask with N.L</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    specularLighting *= color;                                          <span class="comment">// Modulate with light color</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span> ( bDoAmbientOcclusion )                                          <span class="comment">// Optionally modulate with ambient occlusion</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        specularLighting *= fAmbientOcclusion;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> ( bDoRimLighting )                                               <span class="comment">// Optionally do rim lighting</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        rimLighting  = pow( LdotR, fRimExponent );                      <span class="comment">// Raise to rim exponent</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        rimLighting *= saturate(dot( vWorldNormal, vLightDir ));        <span class="comment">// Mask with N.L</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        rimLighting *= color;                                           <span class="comment">// Modulate with light color</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">// Traditional fresnel term approximation</span></div><div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#add0df6b6c291d42a5715b000d21cdffb">  201</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#add0df6b6c291d42a5715b000d21cdffb">Fresnel</a>( <span class="keyword">const</span> float3 vNormal, <span class="keyword">const</span> float3 vEyeDir )</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;{</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordtype">float</span> fresnel = saturate( 1 - dot( vNormal, vEyeDir ) );            <span class="comment">// 1-(N.V) for Fresnel term</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">return</span> fresnel * fresnel;                                           <span class="comment">// Square for a more subtle look</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;}</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">// Traditional fresnel term approximation which uses 4th power (square twice)</span></div><div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#aedba99c3b3804bcc56e2f0ac7e2c7fe4">  208</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#aedba99c3b3804bcc56e2f0ac7e2c7fe4">Fresnel4</a>( <span class="keyword">const</span> float3 vNormal, <span class="keyword">const</span> float3 vEyeDir )</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;{</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordtype">float</span> fresnel = saturate( 1 - dot( vNormal, vEyeDir ) );            <span class="comment">// 1-(N.V) for Fresnel term</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    fresnel = fresnel * fresnel;                                        <span class="comment">// Square</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">return</span> fresnel * fresnel;                                           <span class="comment">// Square again for a more subtle look</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;}</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">// Custom Fresnel with low, mid and high parameters defining a piecewise continuous function</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">// with traditional fresnel (0 to 1 range) as input.  The 0 to 0.5 range blends between</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">// low and mid while the 0.5 to 1 range blends between mid and high</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">//    |</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">//    |    .  M . . . H</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">//    | . </span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">//    L</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">//    |</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">//    +----------------</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">//    0               1</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a3e72725c07ba049089e79add0e14c716">  229</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#add0df6b6c291d42a5715b000d21cdffb">Fresnel</a>( <span class="keyword">const</span> float3 vNormal, <span class="keyword">const</span> float3 vEyeDir, float3 vRanges )</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;{</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">//float result, f = Fresnel( vNormal, vEyeDir );            // Traditional Fresnel</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">//if ( f &gt; 0.5f )</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">//  result = lerp( vRanges.y, vRanges.z, (2*f)-1 );     // Blend between mid and high values</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">//else</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">//  result = lerp( vRanges.x, vRanges.y, 2*f );         // Blend between low and mid values</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">// note: vRanges is now encoded as ((mid-min)*2, mid, (max-mid)*2) to optimize math</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">float</span> f = saturate( 1 - dot( vNormal, vEyeDir ) );</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    f = f*f - 0.5;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">return</span> vRanges.y + (f &gt;= 0.0 ? vRanges.z : vRanges.x) * f;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a71550780dcadaa3e495b2c0c87fc3e92">  243</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a71550780dcadaa3e495b2c0c87fc3e92">PixelShaderDoSpecularLight</a>( <span class="keyword">const</span> float3 vWorldPos, <span class="keyword">const</span> float3 vWorldNormal, <span class="keyword">const</span> <span class="keywordtype">float</span> fSpecularExponent, <span class="keyword">const</span> float3 vEyeDir,</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                                 <span class="keyword">const</span> <span class="keywordtype">float</span> fAtten, <span class="keyword">const</span> float3 vLightColor, <span class="keyword">const</span> float3 vLightDir,</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                                 <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoAmbientOcclusion, <span class="keyword">const</span> <span class="keywordtype">float</span> fAmbientOcclusion,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                                 <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoSpecularWarp, in sampler specularWarpSampler, <span class="keywordtype">float</span> fFresnel,</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                                 <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoRimLighting, <span class="keyword">const</span> <span class="keywordtype">float</span> fRimExponent,</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                                 <span class="comment">// Outputs</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                                 out float3 specularLighting, out float3 rimLighting )</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;{</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">// Compute Specular and rim terms</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a36abecaee35a0b1636ed98b31ef17ff5">SpecularAndRimTerms</a>( vWorldNormal, vLightDir, fSpecularExponent,</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                         vEyeDir, bDoAmbientOcclusion, fAmbientOcclusion,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                         bDoSpecularWarp, specularWarpSampler, fFresnel, vLightColor * fAtten,</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                         bDoRimLighting, fRimExponent, specularLighting, rimLighting );</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#ae2522380e7e7d6124c643e67454c052f">  259</a></span>&#160;float3 <a class="code" href="common__vertexlitgeneric__dx9_8h.html#ae2522380e7e7d6124c643e67454c052f">PixelShaderDoLightingLinear</a>( <span class="keyword">const</span> float3 worldPos, <span class="keyword">const</span> float3 worldNormal,</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                   <span class="keyword">const</span> float3 staticLightingColor, <span class="keyword">const</span> <span class="keywordtype">bool</span> bStaticLight,</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">bool</span> bAmbientLight, <span class="keyword">const</span> float4 lightAtten, <span class="keyword">const</span> float3 cAmbientCube[6],</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                   in sampler NormalizeSampler, <span class="keyword">const</span> <span class="keywordtype">int</span> nNumLights, <a class="code" href="struct_pixel_shader_light_info.html">PixelShaderLightInfo</a> <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[3],</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">bool</span> bHalfLambert, <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoAmbientOcclusion, <span class="keyword">const</span> <span class="keywordtype">float</span> fAmbientOcclusion,</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoLightingWarp, in sampler lightWarpSampler )</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;{</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    float3 linearColor = 0.0f;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">if</span> ( bStaticLight )</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">// The static lighting comes in in gamma space and has also been premultiplied by $cOOOverbright</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="comment">// need to get it into</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="comment">// linear space so that we can do adds.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        linearColor += <a class="code" href="common__fxc_8h.html#af50aa3375b5680172aabe1679bc89b70">GammaToLinear</a>( staticLightingColor * <a class="code" href="common__vertexlitgeneric__dx9_8h.html#abdb10265726098c8785c9237843ce824">cOverbright</a> );</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> ( bAmbientLight )</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        float3 ambient = <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a347c1dd312f8b524eeadf1579aed8312">AmbientLight</a>( worldNormal, cAmbientCube );</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordflow">if</span> ( bDoAmbientOcclusion )</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            ambient *= fAmbientOcclusion * fAmbientOcclusion;   <span class="comment">// Note squaring...</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        linearColor += ambient;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span> ( nNumLights &gt; 0 )</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        linearColor += <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a7b816668d8202ad2ca516b0bc6a3bf3a">PixelShaderDoGeneralDiffuseLight</a>( lightAtten.x, worldPos, worldNormal, NormalizeSampler,</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                                                         <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[0].<a class="code" href="struct_light_info.html#a153d25be0d6e9e96e693e73fca7273a1">pos</a>, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[0].<a class="code" href="struct_light_info.html#a696f8b52d7e032ad0fb46286fe27aebf">color</a>, bHalfLambert,</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                                         bDoAmbientOcclusion, fAmbientOcclusion,</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                                         bDoLightingWarp, lightWarpSampler );</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">if</span> ( nNumLights &gt; 1 )</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            linearColor += <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a7b816668d8202ad2ca516b0bc6a3bf3a">PixelShaderDoGeneralDiffuseLight</a>( lightAtten.y, worldPos, worldNormal, NormalizeSampler,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                                             <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[1].<a class="code" href="struct_light_info.html#a153d25be0d6e9e96e693e73fca7273a1">pos</a>, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[1].<a class="code" href="struct_light_info.html#a696f8b52d7e032ad0fb46286fe27aebf">color</a>, bHalfLambert,</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                                             bDoAmbientOcclusion, fAmbientOcclusion,</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                                             bDoLightingWarp, lightWarpSampler );</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="keywordflow">if</span> ( nNumLights &gt; 2 )</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                linearColor += <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a7b816668d8202ad2ca516b0bc6a3bf3a">PixelShaderDoGeneralDiffuseLight</a>( lightAtten.z, worldPos, worldNormal, NormalizeSampler,</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                                                                 <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[2].<a class="code" href="struct_light_info.html#a153d25be0d6e9e96e693e73fca7273a1">pos</a>, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[2].<a class="code" href="struct_light_info.html#a696f8b52d7e032ad0fb46286fe27aebf">color</a>, bHalfLambert,</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                                                                 bDoAmbientOcclusion, fAmbientOcclusion,</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                                                                 bDoLightingWarp, lightWarpSampler );</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                <span class="keywordflow">if</span> ( nNumLights &gt; 3 )</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                    <span class="comment">// Unpack the 4th light&#39;s data from tight constant packing</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                    float3 vLight3Color = float3( <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[0].color.w, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[0].<a class="code" href="struct_light_info.html#a153d25be0d6e9e96e693e73fca7273a1">pos</a>.w, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[1].<a class="code" href="struct_light_info.html#a696f8b52d7e032ad0fb46286fe27aebf">color</a>.w );</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                    float3 vLight3Pos = float3( <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[1].pos.w, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[2].<a class="code" href="struct_light_info.html#a696f8b52d7e032ad0fb46286fe27aebf">color</a>.w, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[2].<a class="code" href="struct_light_info.html#a153d25be0d6e9e96e693e73fca7273a1">pos</a>.w );</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                    linearColor += <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a7b816668d8202ad2ca516b0bc6a3bf3a">PixelShaderDoGeneralDiffuseLight</a>( lightAtten.w, worldPos, worldNormal, NormalizeSampler,</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                                                                     vLight3Pos, vLight3Color, bHalfLambert,</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                                                     bDoAmbientOcclusion, fAmbientOcclusion,</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                                                                     bDoLightingWarp, lightWarpSampler );</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        }</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">return</span> linearColor;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a401cd299a5eabf58fe53bbefa6501a0c">  321</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a401cd299a5eabf58fe53bbefa6501a0c">PixelShaderDoSpecularLighting</a>( <span class="keyword">const</span> float3 worldPos, <span class="keyword">const</span> float3 worldNormal, <span class="keyword">const</span> <span class="keywordtype">float</span> fSpecularExponent, <span class="keyword">const</span> float3 vEyeDir,</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                    <span class="keyword">const</span> float4 lightAtten, <span class="keyword">const</span> <span class="keywordtype">int</span> nNumLights, <a class="code" href="struct_pixel_shader_light_info.html">PixelShaderLightInfo</a> <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[3],</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoAmbientOcclusion, <span class="keyword">const</span> <span class="keywordtype">float</span> fAmbientOcclusion,</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoSpecularWarp, in sampler specularWarpSampler, <span class="keywordtype">float</span> fFresnel,</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoRimLighting, <span class="keyword">const</span> <span class="keywordtype">float</span> fRimExponent,</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                    <span class="comment">// Outputs</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                    out float3 specularLighting, out float3 rimLighting )</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;{</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    specularLighting = rimLighting = float3( 0.0f, 0.0f, 0.0f );</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    float3 localSpecularTerm, localRimTerm;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">if</span>( nNumLights &gt; 0 )</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a71550780dcadaa3e495b2c0c87fc3e92">PixelShaderDoSpecularLight</a>( worldPos, worldNormal, fSpecularExponent, vEyeDir,</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                                    lightAtten.x, <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a37d7229b0640d7b435f6ad5c24c6071c">PixelShaderGetLightColor</a>( <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>, 0 ),</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                                    <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a5412ac1f9d20bd8519a9a7854b09695d">PixelShaderGetLightVector</a>( worldPos, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>, 0 ),</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                    bDoAmbientOcclusion, fAmbientOcclusion,</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                                    bDoSpecularWarp, specularWarpSampler, fFresnel,</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                    bDoRimLighting, fRimExponent,</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                                    localSpecularTerm, localRimTerm );</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        specularLighting += localSpecularTerm;      <span class="comment">// Accumulate specular and rim terms</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        rimLighting += localRimTerm;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span>( nNumLights &gt; 1 )</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a71550780dcadaa3e495b2c0c87fc3e92">PixelShaderDoSpecularLight</a>( worldPos, worldNormal, fSpecularExponent, vEyeDir,</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                    lightAtten.y, <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a37d7229b0640d7b435f6ad5c24c6071c">PixelShaderGetLightColor</a>( <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>, 1 ),</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                    <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a5412ac1f9d20bd8519a9a7854b09695d">PixelShaderGetLightVector</a>( worldPos, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>, 1 ),</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                                    bDoAmbientOcclusion, fAmbientOcclusion,</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                                    bDoSpecularWarp, specularWarpSampler, fFresnel,</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                                    bDoRimLighting, fRimExponent,</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                                    localSpecularTerm, localRimTerm );</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        specularLighting += localSpecularTerm;      <span class="comment">// Accumulate specular and rim terms</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        rimLighting += localRimTerm;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">if</span>( nNumLights &gt; 2 )</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a71550780dcadaa3e495b2c0c87fc3e92">PixelShaderDoSpecularLight</a>( worldPos, worldNormal, fSpecularExponent, vEyeDir,</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                                    lightAtten.z, <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a37d7229b0640d7b435f6ad5c24c6071c">PixelShaderGetLightColor</a>( <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>, 2 ),</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                                    <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a5412ac1f9d20bd8519a9a7854b09695d">PixelShaderGetLightVector</a>( worldPos, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>, 2 ),</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                                    bDoAmbientOcclusion, fAmbientOcclusion,</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                                    bDoSpecularWarp, specularWarpSampler, fFresnel,</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                                    bDoRimLighting, fRimExponent,</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                    localSpecularTerm, localRimTerm );</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        specularLighting += localSpecularTerm;      <span class="comment">// Accumulate specular and rim terms</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        rimLighting += localRimTerm;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    }</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span>( nNumLights &gt; 3 )</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a71550780dcadaa3e495b2c0c87fc3e92">PixelShaderDoSpecularLight</a>( worldPos, worldNormal, fSpecularExponent, vEyeDir,</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                    lightAtten.w, <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a37d7229b0640d7b435f6ad5c24c6071c">PixelShaderGetLightColor</a>( <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>, 3 ),</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                    <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a5412ac1f9d20bd8519a9a7854b09695d">PixelShaderGetLightVector</a>( worldPos, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>, 3 ),</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                                    bDoAmbientOcclusion, fAmbientOcclusion,</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                                    bDoSpecularWarp, specularWarpSampler, fFresnel,</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                                    bDoRimLighting, fRimExponent,</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                                    localSpecularTerm, localRimTerm );</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        specularLighting += localSpecularTerm;      <span class="comment">// Accumulate specular and rim terms</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        rimLighting += localRimTerm;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;}</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#a0f4db17e4de3de8100c026cbbf4fe37f">  392</a></span>&#160;float3 <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a0f4db17e4de3de8100c026cbbf4fe37f">PixelShaderDoRimLighting</a>( <span class="keyword">const</span> float3 worldNormal, <span class="keyword">const</span> float3 vEyeDir, <span class="keyword">const</span> float3 cAmbientCube[6], <span class="keywordtype">float</span> fFresnel )</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;{</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    float3 vReflect = reflect( -vEyeDir, worldNormal );         <span class="comment">// Reflect view through normal</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">return</span> fFresnel * <a class="code" href="common__vertexlitgeneric__dx9_8h.html#a9203bfdbac5f7bb30cc2321618f8f7cf">PixelShaderAmbientLight</a>( vEyeDir, cAmbientCube );</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;}</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">// Called directly by newer shaders or through the following wrapper for older shaders</span></div><div class="line"><a name="l00400"></a><span class="lineno"><a class="line" href="common__vertexlitgeneric__dx9_8h.html#aa8ddfc7d0a08487380f2678ef35398cc">  400</a></span>&#160;float3 <a class="code" href="common__vertexlitgeneric__dx9_8h.html#aa8ddfc7d0a08487380f2678ef35398cc">PixelShaderDoLighting</a>( <span class="keyword">const</span> float3 worldPos, <span class="keyword">const</span> float3 worldNormal,</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                   <span class="keyword">const</span> float3 staticLightingColor, <span class="keyword">const</span> <span class="keywordtype">bool</span> bStaticLight,</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">bool</span> bAmbientLight, <span class="keyword">const</span> float4 lightAtten, <span class="keyword">const</span> float3 cAmbientCube[6],</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                   in sampler NormalizeSampler, <span class="keyword">const</span> <span class="keywordtype">int</span> nNumLights, <a class="code" href="struct_pixel_shader_light_info.html">PixelShaderLightInfo</a> <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>[3],</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">bool</span> bHalfLambert,</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                   </div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                   <span class="comment">// New optional/experimental parameters</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoAmbientOcclusion, <span class="keyword">const</span> <span class="keywordtype">float</span> fAmbientOcclusion,</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">bool</span> bDoLightingWarp, in sampler lightWarpSampler )</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;{</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    float3 linearColor = <a class="code" href="common__vertexlitgeneric__dx9_8h.html#ae2522380e7e7d6124c643e67454c052f">PixelShaderDoLightingLinear</a>( worldPos, worldNormal, staticLightingColor, </div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                                                      bStaticLight, bAmbientLight, lightAtten,</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                                                      cAmbientCube, NormalizeSampler, nNumLights, <a class="code" href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a>, bHalfLambert,</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                                      bDoAmbientOcclusion, fAmbientOcclusion,</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                                                      bDoLightingWarp, lightWarpSampler );</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="comment">// go ahead and clamp to the linear space equivalent of overbright 2 so that we match</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="comment">// everything else.</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">//      linearColor = HuePreservingColorClamp( linearColor, pow( 2.0f, 2.2 ) );</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">return</span> linearColor;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;}</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="preprocessor">#endif //#ifndef COMMON_VERTEXLITGENERIC_DX9_H_</span></div><div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a9203bfdbac5f7bb30cc2321618f8f7cf"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a9203bfdbac5f7bb30cc2321618f8f7cf">PixelShaderAmbientLight</a></div><div class="ttdeci">float3 PixelShaderAmbientLight(const float3 worldNormal, const float3 cAmbientCube[6])</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:41</div></div>
<div class="ttc" id="struct_pixel_shader_light_info_html_ac15889100963cebf0e2554f2d2a36c69"><div class="ttname"><a href="struct_pixel_shader_light_info.html#ac15889100963cebf0e2554f2d2a36c69">PixelShaderLightInfo::color</a></div><div class="ttdeci">float4 color</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:27</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a7b816668d8202ad2ca516b0bc6a3bf3a"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a7b816668d8202ad2ca516b0bc6a3bf3a">PixelShaderDoGeneralDiffuseLight</a></div><div class="ttdeci">float3 PixelShaderDoGeneralDiffuseLight(const float fAtten, const float3 worldPos, const float3 worldNormal, in sampler NormalizeSampler, const float3 vPosition, const float3 vColor, const bool bHalfLambert, const bool bDoAmbientOcclusion, const float fAmbientOcclusion, const bool bDoLightingWarp, in sampler lightWarpSampler)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:125</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a5412ac1f9d20bd8519a9a7854b09695d"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a5412ac1f9d20bd8519a9a7854b09695d">PixelShaderGetLightVector</a></div><div class="ttdeci">float3 PixelShaderGetLightVector(const float3 worldPos, PixelShaderLightInfo cLightInfo[3], int nLightIndex)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:139</div></div>
<div class="ttc" id="struct_light_info_html_a696f8b52d7e032ad0fb46286fe27aebf"><div class="ttname"><a href="struct_light_info.html#a696f8b52d7e032ad0fb46286fe27aebf">LightInfo::color</a></div><div class="ttdeci">float4 color</div><div class="ttdef"><b>Definition:</b> common_vs_fxc.h:110</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_aedba99c3b3804bcc56e2f0ac7e2c7fe4"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#aedba99c3b3804bcc56e2f0ac7e2c7fe4">Fresnel4</a></div><div class="ttdeci">float Fresnel4(const float3 vNormal, const float3 vEyeDir)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:208</div></div>
<div class="ttc" id="common__ps__fxc_8h_html_abc27c8bf80d2bb826a5172f9c2818c21"><div class="ttname"><a href="common__ps__fxc_8h.html#abc27c8bf80d2bb826a5172f9c2818c21">NormalizeWithCubemap</a></div><div class="ttdeci">HALF3 NormalizeWithCubemap(sampler normalizeSampler, HALF3 input)</div><div class="ttdef"><b>Definition:</b> common_ps_fxc.h:192</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a0f4db17e4de3de8100c026cbbf4fe37f"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a0f4db17e4de3de8100c026cbbf4fe37f">PixelShaderDoRimLighting</a></div><div class="ttdeci">float3 PixelShaderDoRimLighting(const float3 worldNormal, const float3 vEyeDir, const float3 cAmbientCube[6], float fFresnel)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:392</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_aa8ddfc7d0a08487380f2678ef35398cc"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#aa8ddfc7d0a08487380f2678ef35398cc">PixelShaderDoLighting</a></div><div class="ttdeci">float3 PixelShaderDoLighting(const float3 worldPos, const float3 worldNormal, const float3 staticLightingColor, const bool bStaticLight, const bool bAmbientLight, const float4 lightAtten, const float3 cAmbientCube[6], in sampler NormalizeSampler, const int nNumLights, PixelShaderLightInfo cLightInfo[3], const bool bHalfLambert, const bool bDoAmbientOcclusion, const float fAmbientOcclusion, const bool bDoLightingWarp, in sampler lightWarpSampler)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:400</div></div>
<div class="ttc" id="common__ps__fxc_8h_html"><div class="ttname"><a href="common__ps__fxc_8h.html">common_ps_fxc.h</a></div></div>
<div class="ttc" id="struct_light_info_html_a153d25be0d6e9e96e693e73fca7273a1"><div class="ttname"><a href="struct_light_info.html#a153d25be0d6e9e96e693e73fca7273a1">LightInfo::pos</a></div><div class="ttdeci">float4 pos</div><div class="ttdef"><b>Definition:</b> common_vs_fxc.h:112</div></div>
<div class="ttc" id="struct_pixel_shader_light_info_html"><div class="ttname"><a href="struct_pixel_shader_light_info.html">PixelShaderLightInfo</a></div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:25</div></div>
<div class="ttc" id="common__fxc_8h_html_af50aa3375b5680172aabe1679bc89b70"><div class="ttname"><a href="common__fxc_8h.html#af50aa3375b5680172aabe1679bc89b70">GammaToLinear</a></div><div class="ttdeci">float3 GammaToLinear(const float3 gamma)</div><div class="ttdef"><b>Definition:</b> common_fxc.h:189</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_abdb10265726098c8785c9237843ce824"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#abdb10265726098c8785c9237843ce824">cOverbright</a></div><div class="ttdeci">#define cOverbright</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:31</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a86f967e67da1c20e19bda6425d3be3c7"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a86f967e67da1c20e19bda6425d3be3c7">VertexShaderAmbientLight</a></div><div class="ttdeci">float3 VertexShaderAmbientLight(const float3 worldNormal, const float3 cAmbientCube[6])</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:54</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_add0df6b6c291d42a5715b000d21cdffb"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#add0df6b6c291d42a5715b000d21cdffb">Fresnel</a></div><div class="ttdeci">float Fresnel(const float3 vNormal, const float3 vEyeDir)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:201</div></div>
<div class="ttc" id="common__vs__fxc_8h_html_a2ad837f43fb7a3f85231e4f01e2b70e4"><div class="ttname"><a href="common__vs__fxc_8h.html#a2ad837f43fb7a3f85231e4f01e2b70e4">cLightInfo</a></div><div class="ttdeci">LightInfo cLightInfo[4]</div><div class="ttdef"><b>Definition:</b> common_vs_fxc.h:123</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a401cd299a5eabf58fe53bbefa6501a0c"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a401cd299a5eabf58fe53bbefa6501a0c">PixelShaderDoSpecularLighting</a></div><div class="ttdeci">void PixelShaderDoSpecularLighting(const float3 worldPos, const float3 worldNormal, const float fSpecularExponent, const float3 vEyeDir, const float4 lightAtten, const int nNumLights, PixelShaderLightInfo cLightInfo[3], const bool bDoAmbientOcclusion, const float fAmbientOcclusion, const bool bDoSpecularWarp, in sampler specularWarpSampler, float fFresnel, const bool bDoRimLighting, const float fRimExponent, out float3 specularLighting, out float3 rimLighting)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:321</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a347c1dd312f8b524eeadf1579aed8312"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a347c1dd312f8b524eeadf1579aed8312">AmbientLight</a></div><div class="ttdeci">float3 AmbientLight(const float3 worldNormal, const float3 cAmbientCube[6])</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:65</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a36abecaee35a0b1636ed98b31ef17ff5"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a36abecaee35a0b1636ed98b31ef17ff5">SpecularAndRimTerms</a></div><div class="ttdeci">void SpecularAndRimTerms(const float3 vWorldNormal, const float3 vLightDir, const float fSpecularExponent, const float3 vEyeDir, const bool bDoAmbientOcclusion, const float fAmbientOcclusion, const bool bDoSpecularWarp, in sampler specularWarpSampler, const float fFresnel, const float3 color, const bool bDoRimLighting, const float fRimExponent, out float3 specularLighting, out float3 rimLighting)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:167</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a71550780dcadaa3e495b2c0c87fc3e92"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a71550780dcadaa3e495b2c0c87fc3e92">PixelShaderDoSpecularLight</a></div><div class="ttdeci">void PixelShaderDoSpecularLight(const float3 vWorldPos, const float3 vWorldNormal, const float fSpecularExponent, const float3 vEyeDir, const float fAtten, const float3 vLightColor, const float3 vLightDir, const bool bDoAmbientOcclusion, const float fAmbientOcclusion, const bool bDoSpecularWarp, in sampler specularWarpSampler, float fFresnel, const bool bDoRimLighting, const float fRimExponent, out float3 specularLighting, out float3 rimLighting)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:243</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_ae2522380e7e7d6124c643e67454c052f"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#ae2522380e7e7d6124c643e67454c052f">PixelShaderDoLightingLinear</a></div><div class="ttdeci">float3 PixelShaderDoLightingLinear(const float3 worldPos, const float3 worldNormal, const float3 staticLightingColor, const bool bStaticLight, const bool bAmbientLight, const float4 lightAtten, const float3 cAmbientCube[6], in sampler NormalizeSampler, const int nNumLights, PixelShaderLightInfo cLightInfo[3], const bool bHalfLambert, const bool bDoAmbientOcclusion, const float fAmbientOcclusion, const bool bDoLightingWarp, in sampler lightWarpSampler)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:259</div></div>
<div class="ttc" id="struct_pixel_shader_light_info_html_a4322319bb973caf21f78272ad1428f60"><div class="ttname"><a href="struct_pixel_shader_light_info.html#a4322319bb973caf21f78272ad1428f60">PixelShaderLightInfo::pos</a></div><div class="ttdeci">float4 pos</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:28</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a0c47480ee68b5b192353cb2197eb7de8"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a0c47480ee68b5b192353cb2197eb7de8">DiffuseTerm</a></div><div class="ttdeci">float3 DiffuseTerm(const bool bHalfLambert, const float3 worldNormal, const float3 lightDir, const bool bDoAmbientOcclusion, const float fAmbientOcclusion, const bool bDoLightingWarp, in sampler lightWarpSampler)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:86</div></div>
<div class="ttc" id="common__vertexlitgeneric__dx9_8h_html_a37d7229b0640d7b435f6ad5c24c6071c"><div class="ttname"><a href="common__vertexlitgeneric__dx9_8h.html#a37d7229b0640d7b435f6ad5c24c6071c">PixelShaderGetLightColor</a></div><div class="ttdeci">float3 PixelShaderGetLightColor(PixelShaderLightInfo cLightInfo[3], int nLightIndex)</div><div class="ttdef"><b>Definition:</b> common_vertexlitgeneric_dx9.h:153</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_df1e470bc8392a455b09841193f2f465.html">materialsystem</a></li><li class="navelem"><a class="el" href="dir_1fb050cf0f02a943813355fcd006d816.html">stdshaders</a></li><li class="navelem"><a class="el" href="common__vertexlitgeneric__dx9_8h.html">common_vertexlitgeneric_dx9.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
